<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Hamburger Menu Button -->
    <button class="hamburger-menu" id="hamburgerBtn" title="Toggle Menu">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-logo">
            <button class="close-sidebar" id="closeSidebarBtn" title="Close Menu">
                <i class="fas fa-times"></i>
            </button>
            <span><i class="fas fa-book"></i> <span>Dashboard</span></span>
        </div>
        <ul class="sidebar-nav">
            <li><a data-page="overview" class="nav-link active"><i class="fas fa-chart-pie"></i> Overview</a></li>
            <li><a data-page="students" class="nav-link"><i class="fas fa-users"></i> Students</a></li>
            <li class="sidebar-cohorts-divider"><span class="sidebar-section-label">COHORTS</span>
                <ul class="sidebar-section-list">
                    <li><a data-page="cohortmanager" class="nav-link"><i class="fas fa-cogs"></i> Manage Cohorts</a></li>
                    <!-- Dynamic cohorts will be inserted here -->
                    <div id="dynamicCohortsContainer"></div>
                </ul>
            </li>
            <li class="sidebar-settings-divider">
                <a data-page="emailtemplates" class="nav-link"><i class="fas fa-envelope"></i> Email Templates</a>
            </li>
            <li class="sidebar-settings-divider">
                <a data-page="managechecklists" class="nav-link"><i class="fas fa-list-check"></i> Student Checklist</a>
            </li>
            <li class="sidebar-settings-divider">
                <a data-page="settings" class="nav-link"><i class="fas fa-cog"></i> Settings</a>
            </li>
        </ul>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Top Header Bar -->
        <div class="header-bar">
            <div class="header-left">
                <button class="hamburger-menu-header" id="hamburgerBtnHeader" title="Toggle Menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title">Overview</h1>
            </div>
            <div class="header-buttons">
                <button onclick="openAddModal()" class="btn-primary"><i class="fas fa-plus"></i> Add Student</button>
            </div>
        </div>

        <!-- Content Wrapper -->
        <div class="content-wrapper">

            <!-- OVERVIEW PAGE -->
            <div id="overview" class="page active">
                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card total">
                        <div class="stat-label">Total Students</div>
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-subtext">All registered students</div>
                    </div>
                    <div class="stat-card current">
                        <div class="stat-label">Cohort 3</div>
                        <div class="stat-value" id="statCohorts">0</div>
                        <div class="stat-subtext">Students in Cohort 3</div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-label-wrapper">
                            <div class="stat-label">Pending Payment</div>
                            <button class="eye-toggle" id="pendingToggle" title="Toggle pending payment visibility">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                        </div>
                        <div class="stat-value hidden" id="statPending" data-value="$0">‚óè‚óè‚óè‚óè‚óè</div>
                        <div class="stat-subtext">Awaiting payment</div>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-label">Waiting List</div>
                        <div class="stat-value" id="statWaitingList">0</div>
                        <div class="stat-subtext">Students in waiting list</div>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-label">Next Cohort</div>
                        <div class="stat-value" id="statNextCohort">0</div>
                        <div class="stat-subtext">Students for next cohort</div>
                    </div>
                    <div class="stat-card revenue">
                        <div class="stat-label-wrapper">
                            <div class="stat-label">Total Revenue</div>
                            <button class="eye-toggle" id="revenueToggle" title="Toggle revenue visibility">
                                <i class="fas fa-eye-slash"></i>
                            </button>
                        </div>
                        <div class="stat-value hidden" id="statRevenue" data-value="$0">‚óè‚óè‚óè‚óè‚óè</div>
                        <div class="stat-subtext">From paid students</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-title-with-settings">
                            <span>Status Distribution</span>
                            <div class="chart-settings-wrapper">
                                <button class="chart-settings-btn" id="statusChartSettingsBtn" title="Filter by cohorts">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <div class="chart-settings-dropdown" id="statusChartDropdown" style="display: none;">
                                    <div class="dropdown-header">Filter by Cohorts</div>
                                    <div class="dropdown-content" id="statusChartCohortList"></div>
                                    <div class="dropdown-footer">
                                        <button class="btn-small btn-primary" onclick="applyStatusChartFilter()">Apply</button>
                                        <button class="btn-small btn-secondary" onclick="resetStatusChartFilter()">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title">Revenue Status</div>
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title-with-settings">
                            <div class="chart-title">Student Locations</div>
                            <div class="chart-settings-wrapper">
                                <button class="chart-settings-btn" id="locationsChartSettingsBtn" title="Filter locations">
                                    <i class="fas fa-cog"></i>
                                </button>
                                <div class="chart-settings-dropdown" id="locationsChartDropdown" style="display: none;">
                                    <div class="dropdown-header">Filter by Locations</div>
                                    <div class="dropdown-content" id="locationsChartLocationList"></div>
                                    <div class="dropdown-footer">
                                        <button class="btn-small btn-primary" onclick="applyLocationsChartFilter()">Apply</button>
                                        <button class="btn-small btn-secondary" onclick="resetLocationsChartFilter()">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="locationsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Cohort Summary -->
                <div class="section-header-with-settings">
                    <h2 style="margin: 0; padding-top: 20px; border-top: 2px solid #e0e0e0; color: #1a1a1a;"><i class="fas fa-users"></i> Cohort Summary</h2>
                    <div class="cohort-settings-wrapper">
                        <button class="chart-settings-btn" id="cohortsSettingsBtn" title="Show/hide cohorts">
                            <i class="fas fa-cog"></i>
                        </button>
                        <div class="chart-settings-dropdown" id="cohortsDropdown" style="display: none;">
                            <div class="dropdown-header">Show/Hide Cohorts</div>
                            <div class="dropdown-content" id="cohortsList"></div>
                            <div class="dropdown-footer">
                                <button class="btn-small btn-primary" onclick="applyCohortVisibility()">Apply</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="charts-grid" id="cohortsCardsContainer">
                    <!-- Dynamically populated by JavaScript -->
                </div>

                <!-- Analytics Charts Section -->
                <div class="analytics-section">
                    <h2 style="margin-bottom: 20px; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e0e0e0; color: #1a1a1a;"><i class="fas fa-chart-line"></i> Analytics</h2>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-title-with-settings">
                                <div class="chart-title">Revenue by Cohort</div>
                                <div class="chart-settings-wrapper">
                                    <button id="revenueChartSettingsBtn" class="chart-settings-btn" title="Filter cohorts">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                    <div id="revenueChartDropdown" class="chart-settings-dropdown" style="display: none;">
                                        <div class="dropdown-header">Filter by Cohorts</div>
                                        <div class="dropdown-content" id="revenueChartCohortList"></div>
                                        <div class="dropdown-footer">
                                            <button class="btn-small btn-primary" onclick="applyRevenueChartFilter()">Apply</button>
                                            <button class="btn-small btn-secondary" onclick="resetRevenueChartFilter()">Reset</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="cohortRevenueChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title-with-settings">
                                <div class="chart-title">Students by Cohort</div>
                                <div class="chart-settings-wrapper">
                                    <button id="studentsChartSettingsBtn" class="chart-settings-btn" title="Filter cohorts">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                    <div id="studentsChartDropdown" class="chart-settings-dropdown" style="display: none;">
                                        <div class="dropdown-header">Filter by Cohorts</div>
                                        <div class="dropdown-content" id="studentsChartCohortList"></div>
                                        <div class="dropdown-footer">
                                            <button class="btn-small btn-primary" onclick="applyStudentsChartFilter()">Apply</button>
                                            <button class="btn-small btn-secondary" onclick="resetStudentsChartFilter()">Reset</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="cohortStudentsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-title">Language Distribution</div>
                            <div class="chart-container">
                                <canvas id="languageChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Payment Status</div>
                            <div class="chart-container">
                                <canvas id="paymentStatusChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STUDENTS PAGE -->
            <div id="students" class="page">
                <div class="controls students-controls">
                    <input type="text" id="searchStudent" placeholder="Search student..." class="search-input">
                    <div class="status-filter-wrapper status-filter-wrapper-inline">
                        <select id="statusFilterStudents" class="status-filter-custom" multiple size="1">
                            <option value="Cohort 0">Cohort 0</option>
                            <option value="Cohort 1 - Cradis">Cohort 1 - Cradis</option>
                            <option value="Cohort 1 - Zomra">Cohort 1 - Zomra</option>
                            <option value="Cohort 2">Cohort 2</option>
                            <option value="Cohort 3">Cohort 3</option>
                            <option value="English 1">English 1</option>
                        </select>
                    </div>
                    <button class="column-control-button" onclick="createColumnControlModal('students', 'Students')" title="Column visibility settings"><i class="fas fa-sliders-h"></i> Columns</button>
                </div>

                <div class="students-table">
                    <table class="students-data-table">
                        <thead>
                            <tr>
                                <th class="col-id">#</th>
                                <th class="col-name">Name</th>
                                <th class="col-email">Email</th>
                                <th class="col-figmaEmail">Figma Email</th>
                                <th class="col-status">Status</th>
                                <th class="col-location">Location</th>
                                <th class="col-language">Language</th>
                                <th class="col-linkedin">LinkedIn</th>
                                <th class="col-whatsapp">WhatsApp</th>
                                <th class="col-notes">Notes</th>
                                <th class="col-onboarding">Onboarding</th>
                                <th class="col-postcourse">Post-Course</th>
                                <th class="col-paid">Paid</th>
                                <th class="col-remaining">Remaining</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            <tr><td colspan="15" class="empty-tbody-cell">Loading students...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- COHORT PAGES -->
            <div id="cohort0" class="page cohort-page"></div>
            <div id="cohort1" class="page cohort-page"></div>
            <div id="cohort1cradis" class="page cohort-page"></div>
            <div id="cohort1zomra" class="page cohort-page"></div>
            <div id="cohort2" class="page cohort-page"></div>
            <div id="cohort3" class="page cohort-page"></div>
            <div id="english1" class="page cohort-page"></div>

            <!-- STATUS PAGES -->
            <div id="waitinglist" class="page status-page"></div>
            <div id="cantreach" class="page status-page"></div>
            <div id="nextcohort" class="page status-page"></div>
            <div id="standby" class="page status-page"></div>
            <div id="graduated" class="page status-page"></div>

            <!-- EMAIL TEMPLATES PAGE -->
            <div id="emailtemplates" class="page">
                <h2 class="page-title-with-button">
                    <span><i class="fas fa-envelope"></i> Email Templates</span>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="openManageCategoriesModal()" class="btn-secondary" title="Manage categories" style="padding: 8px 16px;"><i class="fas fa-list"></i> Manage Categories</button>
                        <button onclick="openEmailTemplateModal()" class="btn-primary"><i class="fas fa-plus"></i> Create New Template</button>
                    </div>
                </h2>
                
                <!-- NEW STUDENTS TABLE -->
                <div id="newStudentsSection" style="display: none; margin-bottom: 40px;">
                    <h3 style="color: #333; margin-bottom: 16px; font-size: 16px; font-weight: 600; display: flex; align-items: center;"><i class="fas fa-user-plus" style="margin-right: 8px; color: #4ECDC4;"></i> New Students</h3>
                    <div class="students-table">
                        <table class="email-templates-table">
                            <thead>
                                <tr>
                                    <th class="col-template-name">Template Name</th>
                                    <th class="col-button-label">Button Label</th>
                                    <th class="col-subject">Subject</th>
                                    <th class="col-actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="newStudentsBody">
                                <tr><td colspan="4" class="empty-templates-cell">No templates yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- SETUP TEMPLATES TABLE -->
                <div id="setupTemplatesSection" style="display: none; margin-bottom: 40px;">
                    <h3 style="color: #333; margin-bottom: 16px; font-size: 16px; font-weight: 600; display: flex; align-items: center;"><i class="fas fa-rocket" style="margin-right: 8px; color: #FF6B6B;"></i> Setup Templates</h3>
                    <div class="students-table">
                        <table class="email-templates-table">
                            <thead>
                                <tr>
                                    <th class="col-template-name">Template Name</th>
                                    <th class="col-button-label">Button Label</th>
                                    <th class="col-subject">Subject</th>
                                    <th class="col-actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="setupTemplatesBody">
                                <tr><td colspan="4" class="empty-templates-cell">No templates yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- RESOURCES TEMPLATES TABLE -->
                <div id="resourcesTemplatesSection" style="display: none; margin-bottom: 40px;">
                    <h3 style="color: #333; margin-bottom: 16px; font-size: 16px; font-weight: 600; display: flex; align-items: center;"><i class="fas fa-folder" style="margin-right: 8px; color: #4ECDC4;"></i> Resources & Tools</h3>
                    <div class="students-table">
                        <table class="email-templates-table">
                            <thead>
                                <tr>
                                    <th class="col-template-name">Template Name</th>
                                    <th class="col-button-label">Button Label</th>
                                    <th class="col-subject">Subject</th>
                                    <th class="col-actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="resourcesTemplatesBody">
                                <tr><td colspan="4" class="empty-templates-cell">No templates yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- PAYMENTS & COMPLETION TABLE -->
                <div id="paymentsTemplatesSection" style="display: none;">
                    <h3 style="color: #333; margin-bottom: 16px; font-size: 16px; font-weight: 600; display: flex; align-items: center;"><i class="fas fa-credit-card" style="margin-right: 8px; color: #F7DC6F;"></i> Payments & Completion</h3>
                    <div class="students-table">
                        <table class="email-templates-table">
                            <thead>
                                <tr>
                                    <th class="col-template-name">Template Name</th>
                                    <th class="col-button-label">Button Label</th>
                                    <th class="col-subject">Subject</th>
                                    <th class="col-actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTemplatesBody">
                                <tr><td colspan="4" class="empty-templates-cell">No templates yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- COHORT MANAGER PAGE -->
            <div id="cohortmanager" class="page">
                <h2 class="page-title-with-button">
                    <span><i class="fas fa-cogs"></i> Manage Cohorts</span>
                    <button onclick="openAddCohortModal()" class="btn-primary"><i class="fas fa-plus"></i> Add Cohort</button>
                </h2>
                
                <div class="students-table">
                    <table class="cohorts-table">
                        <thead>
                            <tr>
                                <th>Cohort Name</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="cohortsTableBody">
                            <tr><td colspan="2" class="empty-cell">No cohorts yet. Create one to get started!</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- MANAGE CHECKLISTS PAGE -->
            <div id="managechecklists" class="page">
                <h2 class="page-title-with-button">
                    <span><i class="fas fa-list-check"></i> Student Checklist</span>
                    <button onclick="openAddChecklistItemModal()" class="btn-primary"><i class="fas fa-plus"></i> Add Item</button>
                </h2>

                <div id="checklistItemsContainer" style="margin-top: 20px;">
                    <p style="text-align: center; color: #999; padding: 40px;">Loading checklist items...</p>
                </div>
            </div>

            <!-- SETTINGS PAGE -->
            <div id="settings" class="page">
                <h2 class="settings-title"><i class="fas fa-cog"></i> Settings</h2>
                
                <div class="students-table">
                    <table>
                        <tbody>
                            <tr class="settings-table-row">
                                <td class="settings-table-label"><i class="fas fa-chart-bar"></i> Sync to Google Sheets</td>
                                <td class="settings-table-action">
                                    <button onclick="syncToGoogleSheets()" class="btn-primary"><i class="fas fa-cloud"></i> Update Sheet Now</button>
                                    <a href="https://docs.google.com/spreadsheets/d/1nZJJGgwRgv8KrKp3EY_5X94iTPzyNxIw_hCq28yuw-k/edit?usp=sharing" target="_blank" class="btn-primary" style="text-decoration: none; margin-left: 8px; display: inline-flex; align-items: center;"><i class="fas fa-external-link-alt"></i> Open Sheet</a>
                                </td>
                            </tr>
                            <tr class="settings-table-row">
                                <td class="settings-table-label"><i class="fas fa-list"></i> Waiting List Requests</td>
                                <td class="settings-table-action">
                                    <a href="https://docs.google.com/spreadsheets/d/1_47qWqLABo9fRZDLYhBT4UPGVSkZHHVanayuBFln_l4/edit?usp=sharing" target="_blank" class="btn-primary" style="text-decoration: none; display: inline-flex; align-items: center;"><i class="fas fa-external-link-alt"></i> View Requests</a>
                                </td>
                            </tr>
                            <tr class="settings-table-row">
                                <td class="settings-table-label">Export Student Data</td>
                                <td class="settings-table-action">
                                    <button onclick="exportData()" class="btn-primary"><i class="fas fa-download"></i> Export as JSON</button>
                                </td>
                            </tr>
                            <tr class="settings-table-row">
                                <td class="settings-table-label">Import Student Data</td>
                                <td class="settings-table-action">
                                    <button onclick="importData()" class="btn-primary"><i class="fas fa-upload"></i> Import from JSON</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="settings-table-label-error">Clear All Data</td>
                                <td class="settings-table-action">
                                    <button onclick="clearAllData()" class="btn-small btn-danger"><i class="fas fa-trash"></i> Clear All</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="settings-tip"><i class="fas fa-lightbulb"></i> Tip: Click "Update Sheet Now" to push all dashboard data to your Google Sheet. Use Export to backup your data, and Import to restore it.</p>
                <div id="syncStatus"></div>
            </div>

        </div>
    </div>

    <input type="file" id="importFile" accept=".json" class="import-file-input" onchange="handleImport(event)">

    <!-- Add/Edit Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeStudentModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-user-plus modal-header-icon"></i> <span id="modalTitle">Add New Student</span></div>
            
            <form id="studentForm" onsubmit="saveStudent(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Name *</label>
                        <input type="text" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="linkedin">LinkedIn Profile</label>
                        <input type="url" id="linkedin" placeholder="https://linkedin.com/in/username">
                    </div>
                    <div class="form-group">
                        <label for="whatsapp">WhatsApp Number</label>
                        <input type="tel" id="whatsapp">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="figmaEmail">Figma Email</label>
                        <input type="email" id="figmaEmail" placeholder="student@example.com">
                    </div>
                    <div class="form-group">
                        <label for="location">Location (Country)</label>
                        <input type="text" id="location">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="language">Language</label>
                        <select id="language">
                            <option value="">Select Language</option>
                            <option value="English">English</option>
                            <option value="Arabic">Arabic</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status">
                            <option value="">Select Status</option>
                            <option value="Waiting list">Waiting list</option>
                            <option value="Can't reach">Can't reach</option>
                            <option value="Next Cohort">Next Cohort</option>
                            <option value="Standby">Standby</option>
                            <option value="Cohort 0">Cohort 0</option>
                            <option value="Cohort 1 - Cradis">Cohort 1 - Cradis</option>
                            <option value="Cohort 1 - Zomra">Cohort 1 - Zomra</option>
                            <option value="Cohort 2">Cohort 2</option>
                            <option value="Cohort 3">Cohort 3</option>
                            <option value="English 1">English 1</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="note">Notes</label>
                        <input type="text" id="note" placeholder="Add any notes about the student">
                    </div>
                    <div class="form-group">
                        <label for="paymentMethod">Payment Method</label>
                        <select id="paymentMethod">
                            <option value="">Select Payment Method</option>
                            <option value="Stripe">Stripe</option>
                            <option value="Instapay">Instapay</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="studentPassword">Student Login Password <span style="color: #ff6b6b; font-size: 12px;">(Optional)</span></label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="password" id="studentPassword" placeholder="Leave empty to keep existing password">
                            <button type="button" onclick="generateRandomPassword()" class="btn-small" title="Generate random password" style="white-space: nowrap;">
                                <i class="fas fa-dice"></i> Generate
                            </button>
                        </div>
                        <small style="color: #666; margin-top: 4px; display: block;">Set a password for the student to login to their dashboard</small>
                    </div>
                </div>

                <div class="form-row form-row-3col">
                    <div class="form-group">
                        <label for="totalAmount">Total Amount</label>
                        <input type="number" id="totalAmount" step="0.01" onchange="calculateRemaining()" oninput="calculateRemaining()">
                    </div>
                    <div class="form-group">
                        <label for="paidAmount">Paid Amount</label>
                        <input type="number" id="paidAmount" step="0.01" value="0" onchange="calculateRemaining()" oninput="calculateRemaining()">
                    </div>
                    <div class="form-group">
                        <label for="remaining">Remaining</label>
                        <input type="number" id="remaining" step="0.01" value="0" readonly>
                    </div>
                </div>

                <!-- Checklist Section - Always displayed, dynamically populated -->
                <div id="checklistSection" class="checklist-section">
                    <h3 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">üìã Student Checklist</h3>
                    <div class="checklist-content">
                        <!-- Dynamic checklist items will be rendered here -->
                        <p style="color: #999; padding: 20px; text-align: center;">Loading checklist...</p>
                    </div>
                </div>

                <!-- Email Templates Section -->
                <div id="emailTemplatesSection" class="email-templates-section" style="display: none;">
                    <h3>üìß Send Email Templates</h3>
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Select templates to send when saving this student</p>
                    <div id="emailTemplatesCheckboxList"></div>
                </div>

                <div class="modal-buttons">
                    <button type="button" onclick="closeStudentModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Student</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Email Template Modal -->
    <div id="emailTemplateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEmailTemplateModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-envelope modal-header-icon"></i> <span id="emailModalTitle">Create Email Template</span></div>
            
            <form id="emailTemplateForm" onsubmit="saveEmailTemplate(event)">
                <div class="form-group">
                    <label for="templateName">Template Name *</label>
                    <input type="text" id="templateName" required placeholder="e.g., Community Invitation">
                </div>

                <div class="form-group">
                    <label for="templateCategory">Category *</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <select id="templateCategory" required style="flex: 1;">
                            <option value="">Select Category</option>
                        </select>
                        <button type="button" onclick="openAddCategoryModal()" class="btn-small" title="Add new category" style="padding: 8px 12px;"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="buttonLabel">Button Label *</label>
                    <input type="text" id="buttonLabel" required placeholder="e.g., Send Invitation">
                </div>

                <div class="form-group">
                    <label for="emailSubject">Email Subject *</label>
                    <input type="text" id="emailSubject" required placeholder="e.g., Welcome to Design Tokens!">
                </div>

                <div class="form-group">
                    <label for="emailBody">Email Body *</label>
                    <textarea id="emailBody" required class="email-body-textarea"></textarea>
                    <small class="email-body-help"><i class="fas fa-info-circle"></i> <strong>Available dynamic tags:</strong> {name}, {email}, {cohort}, {status}, {location}, {language}, {linkedin}, {whatsapp}, {figmaEmail}, {paymentMethod}, {totalAmount}, {paidAmount}, {remaining}, {note}</small>
                </div>

                <div class="modal-buttons">
                    <button type="button" onclick="closeEmailTemplateModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Template</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Email Template Category Modal -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="closeAddCategoryModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-folder-plus modal-header-icon"></i> Add New Category</div>
            
            <form id="addCategoryForm" onsubmit="saveNewCategory(event)">
                <div class="form-group">
                    <label for="categoryName">Category Name *</label>
                    <input type="text" id="categoryName" required placeholder="e.g., Onboarding">
                </div>

                <div class="modal-buttons">
                    <button type="button" onclick="closeAddCategoryModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Add Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Email Template Categories Modal -->
    <div id="manageCategoriesModal" class="modal">
        <div class="modal-content manage-categories-content">
            <span class="close" onclick="closeManageCategoriesModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-list modal-header-icon"></i> Manage Categories</div>
            
            <div class="manage-categories-grid">
                <!-- Existing Categories List -->
                <div class="categories-list-section">
                    <h3 class="categories-section-title">Existing Categories</h3>
                    <div class="categories-list-container">
                        <table class="categories-table">
                            <thead>
                                <tr class="categories-table-header">
                                    <th class="categories-table-header-name">Name</th>
                                    <th class="categories-table-header-actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesListBody">
                                <tr><td colspan="2" class="categories-loading-cell">Loading categories...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add New Category Form -->
                <div class="add-category-section">
                    <h3 class="categories-section-title">Add New Category</h3>
                    <form id="addCategoryFormInline" onsubmit="saveNewCategoryFromModal(event)" class="add-category-form">
                        <div class="form-group add-category-form-group">
                            <label for="categoryNameInline" class="add-category-label">Category Name *</label>
                            <input type="text" id="categoryNameInline" required placeholder="e.g., Onboarding" class="add-category-input">
                        </div>
                        <button type="submit" class="btn-primary add-category-button"><i class="fas fa-plus"></i> Create Category</button>
                    </form>
                    <div id="categorySuccessMessage" class="category-success-message">
                        <i class="fas fa-check-circle"></i> Category added successfully!
                    </div>
                </div>
            </div>

            <div class="modal-buttons manage-categories-buttons">
                <button type="button" onclick="closeManageCategoriesModal()" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div id="editCategoryModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="closeEditCategoryModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-edit modal-header-icon"></i> Edit Category</div>
            
            <form id="editCategoryForm" onsubmit="saveEditedCategory(event)">
                <div class="form-group">
                    <label for="editCategoryName">Category Name *</label>
                    <input type="text" id="editCategoryName" required placeholder="e.g., Onboarding">
                    <input type="hidden" id="editCategoryOldName">
                </div>

                <div class="modal-buttons">
                    <button type="button" onclick="closeEditCategoryModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Email Modal -->
    <div id="bulkEmailModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBulkEmailModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-envelope modal-header-icon"></i> Send Bulk Email</div>
            
            <form id="bulkEmailForm" onsubmit="sendBulkEmail(event)">
                <div class="form-group">
                    <label for="bulkTemplate">Select Template *</label>
                    <select id="bulkTemplate" required onchange="updateBulkRecipientCount()">
                        <option value="">-- Choose a template --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><strong>Select Group *</strong></label>
                    <div id="bulkGroupOptions" class="bulk-group-options">
                        <!-- Radio buttons will be populated here -->
                    </div>
                </div>

                <div class="bulk-recipient-preview">
                    <div class="preview-card">
                        <i class="fas fa-users"></i>
                        <div>
                            <div class="preview-label">Recipients</div>
                            <div class="preview-count" id="bulkRecipientCount">0</div>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons">
                    <button type="button" onclick="closeBulkEmailModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary"><i class="fas fa-paper-plane"></i> Send to Group</button>
                </div>
            </form>

            <div id="bulkEmailStatus" class="bulk-email-status"></div>
        </div>
    </div>

    <!-- Student Contact Modal -->
    <div id="studentContactModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeStudentContactModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-paper-plane modal-header-icon"></i> Contact Student</div>
            
            <div id="studentContactInfo" class="contact-info-background">
                <div id="allContactDetails" class="contact-info-grid"></div>
                <div id="checklistContactInfo"></div>
            </div>

            <!-- Email History Section -->
            <div id="emailHistorySection" class="email-history-section">
                <h4>üìß Email History</h4>
                <div id="emailHistoryList" class="email-history-list">
                    <p style="color: #999; font-size: 13px; margin: 0;">No emails sent yet</p>
                </div>
            </div>

            <h3 class="contact-modal-title">Send Email</h3>
            
            <div id="emailLoadingIndicator" class="email-loading-indicator">
                <div class="loading-spinner"></div>
                <span class="loading-text">Sending email...</span>
            </div>
            
            <div id="studentEmailTemplates" class="contact-email-templates"></div>

            <div class="modal-buttons contact-modal-buttons">
                <button type="button" onclick="closeStudentContactModal()" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Cohort Modal -->
    <div id="cohortModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeCohortModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-plus modal-header-icon"></i> <span id="cohortModalTitle">Add New Cohort</span></div>
            
            <form id="cohortForm" onsubmit="saveCohort(event)">
                <div class="form-group">
                    <label for="cohortName">Cohort Name *</label>
                    <input type="text" id="cohortName" required placeholder="Enter cohort name">
                </div>
                
                <div class="form-group">
                    <label for="cohortIcon">Icon</label>
                    <div id="iconPicker" class="icon-picker">
                        <button type="button" class="icon-option" data-icon="fa-map-pin" title="Map Pin"><i class="fas fa-map-pin"></i></button>
                        <button type="button" class="icon-option" data-icon="fa-pause" title="Pause"><i class="fas fa-pause"></i></button>
                        <button type="button" class="icon-option" data-icon="fa-arrow-right" title="Arrow Right"><i class="fas fa-arrow-right"></i></button>
                        <button type="button" class="icon-option" data-icon="fa-phone-slash" title="Phone Slash"><i class="fas fa-phone-slash"></i></button>
                        <button type="button" class="icon-option" data-icon="fa-clock" title="Clock"><i class="fas fa-clock"></i></button>
                    </div>
                    <input type="hidden" id="cohortIcon" value="fa-map-pin">
                </div>
                
                <div class="form-group">
                    <label for="cohortColor">Color</label>
                    <div id="colorPicker" class="color-picker">
                        <button type="button" class="color-option" data-color="#FF6B6B" style="background-color: #FF6B6B;" title="Red"></button>
                        <button type="button" class="color-option" data-color="#4ECDC4" style="background-color: #4ECDC4;" title="Teal"></button>
                        <button type="button" class="color-option" data-color="#45B7D1" style="background-color: #45B7D1;" title="Blue"></button>
                        <button type="button" class="color-option" data-color="#FFA07A" style="background-color: #FFA07A;" title="Orange"></button>
                        <button type="button" class="color-option" data-color="#98D8C8" style="background-color: #98D8C8;" title="Mint"></button>
                        <button type="button" class="color-option" data-color="#F7DC6F" style="background-color: #F7DC6F;" title="Yellow"></button>
                        <button type="button" class="color-option" data-color="#BB8FCE" style="background-color: #BB8FCE;" title="Purple"></button>
                        <button type="button" class="color-option" data-color="#85C1E2" style="background-color: #85C1E2;" title="Sky Blue"></button>
                        <button type="button" class="color-option" data-color="#F8B88B" style="background-color: #F8B88B;" title="Peach"></button>
                        <button type="button" class="color-option" data-color="#ABEBC6" style="background-color: #ABEBC6;" title="Light Green"></button>
                        <button type="button" class="color-option" data-color="#F5B041" style="background-color: #F5B041;" title="Amber"></button>
                        <button type="button" class="color-option" data-color="#D7BDE2" style="background-color: #D7BDE2;" title="Lavender"></button>
                    </div>
                    <input type="hidden" id="cohortColor" value="#4ECDC4">
                </div>
                
                <div class="modal-buttons">
                    <button type="button" onclick="closeCohortModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Cohort</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Checklist Item Modal -->
    <div id="addChecklistItemModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeAddChecklistItemModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-plus modal-header-icon"></i> Add Checklist Item</div>
            
            <form id="addChecklistItemForm" onsubmit="saveChecklistItem(event)">
                <div class="form-group">
                    <label for="newChecklistItemCategory">Category *</label>
                    <select id="newChecklistItemCategory" required>
                        <option value="">-- Select Category --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="newChecklistItemLabel">Label *</label>
                    <input type="text" id="newChecklistItemLabel" required placeholder="e.g., Shared feedback form">
                </div>

                <div class="modal-buttons">
                    <button type="button" onclick="closeAddChecklistItemModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Add Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Checklist Item Modal -->
    <div id="editChecklistItemModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeEditChecklistItemModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-edit modal-header-icon"></i> Edit Checklist Item</div>
            
            <form id="editChecklistItemForm" onsubmit="saveEditedChecklistItem(event)">
                <input type="hidden" id="editChecklistItemId">

                <div class="form-group">
                    <label for="editChecklistItemCategory">Category *</label>
                    <select id="editChecklistItemCategory" required>
                        <option value="">-- Select Category --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editChecklistItemLabel">Label *</label>
                    <input type="text" id="editChecklistItemLabel" required placeholder="e.g., Shared feedback form">
                </div>

                <div class="modal-buttons">
                    <button type="button" onclick="closeEditChecklistItemModal()" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Checklist Categories Modal -->
    <div id="manageChecklistCategoriesModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeManageChecklistCategoriesModal()"><i class="fas fa-times"></i></span>
            <div class="modal-header"><i class="fas fa-list modal-header-icon"></i> Manage Categories</div>
            
            <div style="margin-bottom: 20px;">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="newCategoryInput" placeholder="Enter new category name" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <button onclick="addNewChecklistCategory()" class="btn-primary" style="padding: 8px 16px;"><i class="fas fa-plus"></i> Add</button>
                </div>
                <div id="categoriesListContainer" style="max-height: 400px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="app.js"></script>
    <script src="cohort_resources.js"></script>
</body>
</html>